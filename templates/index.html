<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>エリたま編成ジェネレーター</title>

    <meta name="description"
        content="このツールは「エイリアンのたまご(エリたま)」の編成支援ジェネレーターです。チームに加えたエイリアンの個性発動条件が満たされているかをリアルタイムでシミュレーションできます。">
    <meta name="google-site-verification" content="rN0Cu7smvs0R4SD-s216F1z3JjXi0aG3WSrqoGzEkeU" />
    <meta name="theme-color" content="#0f172a">
    <link rel="manifest" href="/static/manifest.json">
    <link rel="icon" type="image/png" href="/static/main_icon.png">
    <link rel="apple-touch-icon" href="/static/main_icon.png">
    <script src="/static/js/main.js" defer></script>

    <style>
        /* ==========================================================================
            基本設定・変数定義
           ========================================================================== */
        :root {
            --header-height: 4.739vh;
            --dark-bg: #2a3a4a;
            --light-text: #fff;
            --accent-green: #00ffc8;
            --border-color: #4a5a6a;
            --slot-bg: #1a2a3a;
        }

        /* ==========================================================================
           ローディング画面
           ========================================================================== */
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--dark-bg);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1002;
            color: var(--light-text);
            font-weight: bold;
            text-align: center;
        }

        #loading-overlay p:first-child {
            font-size: 7vw;
        }

        #loading-message {
            font-size: 5vw;
            margin-top: 1rem;
            color: var(--accent-green);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--dark-bg);
            color: var(--light-text);
            margin: 0;
            padding: 0;
            font-size: 1.895vh;
            overflow: hidden;
            /* スクロールバーを隠す（デスクトップ） */
            width: 100vw;
            /* ビューポート幅に固定 */
            height: 100vh;
            /* ビューポート高さに固定 */
            overscroll-behavior-x: none;
            /* 横方向のオーバースクロール（戻るジェスチャー）を無効化 */
            touch-action: pan-y pinch-zoom;
            /* 縦スクロールとピンチズームのみ許可 */
        }

        /* モバイルブラウザではスクロールを許可（ブラウザのヘッダーを無視してスクロール可能にする） */
        @media (max-width: 768px) {
            body {
                overflow-y: auto;
                /* 縦スクロールを許可 */
                overflow-x: hidden;
                /* 横スクロールは禁止 */
                /* height: 100vh のまま（UIの高さは変更しない） */
            }
        }

        * {
            box-sizing: border-box;
        }

        button,
        a {
            -webkit-tap-highlight-color: transparent;
        }

        button:focus,
        a:focus {
            outline: none;
        }

        /* ==========================================================================
            全体レイアウト
           ========================================================================== */
        #main-content {
            display: none;
            flex-direction: column;
            height: 100vh;
            /* ビューポート全体の高さ */
        }

        .header {
            position: sticky;
            top: 0;
            z-index: 3000;
            height: var(--header-height);
            background-color: var(--dark-bg);
            border-bottom: 0.237vh solid var(--accent-green);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 0;
            flex-shrink: 0;
        }

        .header-title-container {
            display: flex;
            align-items: center;
            gap: 0.8vh;
        }

        .header-title-icon {
            height: calc(var(--header-height) * 0.6);
            width: auto;
            object-fit: contain;
        }

        /* 管理モード時はネオンカラーをすべてオレンジに */
        body.admin-mode,
        body.admin-mode * {
            --accent-green: #ff8800 !important;
        }

        #header-title {
            cursor: pointer;
            user-select: none;
        }

        #header-title.has-changes {
            color: var(--accent-green);
            text-decoration: underline;
        }

        #header-title.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .layout-wrapper {
            max-width: 100vw;
            /* 画面幅いっぱいまで広げる */
            width: 100%;
            /* 横幅いっぱいに広がるようにする */
            margin: 0 auto;
            position: relative;
            z-index: 1;
            overflow: hidden;
            /* 画面幅を超える部分は隠す */
            flex-grow: 1;
            /* 残りの高さをすべて埋める */
        }

        .main-container {
            display: flex;
            height: 100%;
            width: 100%;
            /* 親要素の幅に収める */
            overflow: hidden;
            /* はみ出しを隠す */
        }

        /* ==========================================================================
            パーティ表示エリア
        ========================================================================== */
        .party-display-area {
            width: 46.208vh;
            /* 固定幅 */
            max-width: 100%;
            /* モバイルでは画面幅に収める */
            height: 100%;
            overflow: visible;
            /* この領域からはみ出したパーティも見えるように */
            position: relative;
            padding: 0 0.947vh 0.947vh 0.947vh;
            /* 上余白なし、左右下に余白 */
            margin: 0 auto;
            /* 中央配置 */
            overscroll-behavior-x: none;
            /* 横方向のオーバースクロールを無効化 */
        }

        /* --- ▼▼▼ 追加 ▼▼▼ --- */
        /* 5つのパーティを横に並べるためのラッパー */
        #party-slider-wrapper {
            display: flex;
            width: 100%;
            /* 表示エリアに対して100% */
            height: 100%;
            transition: transform 0.15s ease-in-out;
            /* アニメーション速度2倍速 */
        }

        /* --- ▲▲▲ 追加 ▲▲▲ --- */

        .party-container {
            flex-direction: column;
            gap: 0.474vh;
            height: 100%;
            min-width: 100%;
            /* 各パーティが表示エリアの100%を占める */
            max-width: 100%;
            /* はみ出しを防ぐ */
            flex-shrink: 0;
            /* 縮小を防ぐ */
            display: flex;
            padding: 0 0.5vh;
            /* 左右に余白を追加 */
        }

        .party-container.active {
            display: flex;
        }

        /* activeクラスで表示 */
        .party-slot {
            position: relative;
            background-color: var(--slot-bg);
            border: 0.118vh solid var(--border-color);
            border-radius: 0.947vh;
            display: grid;
            padding: 0.947vh;
            height: calc((100% - 1.895vh) / 5);
            gap: 0.474vh 0.947vh;
            grid-template-columns: 9.478vh 13.033vh 1fr;
            grid-template-rows: 1fr;
            grid-template-areas: "character stats skills";
            overflow: visible;
            max-width: 100%;
            transition: transform 0.15s ease-in-out;
            /* リオーダー時のFLIP用 */
        }

        /* 左列: キャラクターエリア（名前 + アイコンの縦配置） */
        .slot-character-area {
            grid-area: character;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            border-radius: 0.474vh;
            padding: 0.474vh;
            gap: 0.474vh;
        }

        /* 属性に応じたアイコン枠の色 */
        .slot-character-area[data-attribute="1"] .slot-character-icon {
            border-color: #ffcccc;
            border-width: 0.355vh;
        }

        /* 動物 */
        .slot-character-area[data-attribute="2"] .slot-character-icon {
            border-color: #c4e5a0;
            border-width: 0.355vh;
        }

        /* 昆虫 */
        .slot-character-area[data-attribute="3"] .slot-character-icon {
            border-color: #c4d9ff;
            border-width: 0.355vh;
        }

        /* 機械 */
        .slot-character-area[data-attribute="4"] .slot-character-icon {
            border-color: #e0ccff;
            border-width: 0.355vh;
        }

        /* ナゾ */

        .slot-character-name {
            width: 100%;
            text-align: center;
            font-weight: bold;
            font-size: 0.93vh;
            color: white;
            line-height: 1.2;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            margin-top: 0.5vh;
        }

        .slot-character-icon {
            width: 100%;
            max-width: 8.293vh;
            height: auto;
            border: 0.237vh solid var(--border-color);
            border-radius: 0.947vh;
            cursor: pointer;
            -webkit-user-drag: element;
            touch-action: none;
            flex-shrink: 0;
            margin-top: auto;
            margin-bottom: auto;
        }

        .slot-character-icon-placeholder {
            width: 100%;
            max-width: 8.293vh;
            aspect-ratio: 1 / 1;
            border: 0.237vh dashed var(--border-color);
            border-radius: 0.947vh;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
            touch-action: none;
            flex-shrink: 0;
            margin-top: auto;
            margin-bottom: auto;
        }

        /* 編成解除ボタン */
        .remove-button {
            width: 100%;
            max-width: 8.293vh;
            padding: 0.3vh 0;
            background-color: #dc3545;
            border: 0.118vh solid #c82333;
            border-radius: 0.474vh;
            color: white;
            font-size: 1vh;
            font-weight: bold;
            cursor: pointer;
            text-align: center;
            -webkit-tap-highlight-color: transparent;
            transition: background-color 0.2s;
        }

        .remove-button:hover {
            background-color: #c82333;
        }

        .remove-button:active {
            background-color: #bd2130;
        }

        /* 中列: ステータスエリア */
        .slot-stats-area {
            grid-area: stats;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 0.9vh;
        }

        .stats-block {
            font-size: 0.855em;
        }

        .stats-hp-power-block {
            background-color: #1a252a;
            border: 0.118vh solid #0a1a1a;
            border-radius: 0.474vh;
            padding: 0.474vh;
            box-shadow: inset 0 0.118vh 0.237vh rgba(0, 0, 0, 0.5);
        }

        .stats-value-row {
            font-size: 0.81em;
            line-height: 1.4;
            white-space: nowrap;
            display: flex;
            justify-content: space-between;
        }

        .stats-value-label {
            text-align: left;
        }

        .stats-value-number {
            text-align: right;
            font-weight: bold;
        }

        .stats-block-label {
            font-size: 0.532em;
        }

        /* 30%削減: 0.76 * 0.7 = 0.532 */
        .stats-block-divider {
            border-bottom: 0.118vh solid var(--border-color);
            margin: 0.237vh 0;
        }

        .icon-container {
            display: flex;
            flex-wrap: wrap;
            margin-top: 0.474vh;
        }

        .info-icon {
            width: 2.369vh;
            height: 2.369vh;
            margin-right: -0.059vh;
        }

        .icon-placeholder-small {
            width: 2.369vh;
            height: 2.369vh;
            margin-right: -0.059vh;
        }

        img.info-icon[src*="/f"]+img.info-icon[src*="/e"] {
            margin-left: 0.592vh;
        }

        .slot-skills-area {
            grid-area: skills;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            position: relative;
            overflow: hidden;
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
        }

        .skill-block {
            font-size: 0.855em;
            border-bottom: 0.118vh solid var(--border-color);
            padding-bottom: 0.237vh;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
            min-height: 25%;
            width: 100%;
            max-width: 100%;
            overflow: hidden;
            box-sizing: border-box;
        }

        .skill-block:last-child {
            border-bottom: none;
        }

        /* 特技と個性1の境界線を強調（通常の2倍） */
        .skill-block.special-skill {
            border-bottom: 0.237vh solid var(--border-color);
        }

        .skill-label {
            font-size: 0.9vh;
            color: #9aabac;
        }

        .skill-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .skill-name {
            font-weight: bold;
            font-size: 1.125vh;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* ▽▽▽ 既存の .req-icon-wrapper 関連のCSS (231～248行目あたり) を削除し、以下に置き換え ▽▽▽ */
        .skill-req-icons {
            display: flex;
            gap: 0.237vh;
            flex-shrink: 0;
            margin-left: 0.474vh;
            margin-right: 0.8vh;
            position: relative;
            bottom: 0.5vh;
        }

        .req-icon {
            position: relative;
            /* ◯✕ (::after) の基準位置 */
            width: 2.137vh;
            height: 2.137vh;
            /* ！！！ (★削除★) filter: grayscale は使いません ！！！ */
        }

        .req-icon img {
            width: 100%;
            height: 100%;
            display: block;
        }

        /* ！！！ (★修正★) "以外" の場合に画像をひっくり返す ！！！ */
        .req-icon[style*="scaleY(-1)"] img {
            /* (注: style属性で transform: scaleY(-1) が直接 .req-icon に付与されます) */
            filter: drop-shadow(0 0 1px #fff);
            /* 反転が分かりやすいよう少し光らせる */
        }

        /* (★復活★) 元の◯✕ アイコンの表示 */
        .req-icon::after {
            content: '';
            position: absolute;
            bottom: -0.32vh;
            right: -0.37vh;
            width: 1.185vh;
            height: 1.185vh;
            border-radius: 50%;
            background-color: grey;
            color: white;
            font-size: 0.947vh;
            font-weight: bold;
            display: none;
            /* 普段は隠す */
            align-items: center;
            justify-content: center;
            border: 0.118vh solid white;
            z-index: 1;
        }

        /* met または unmet クラスが付いたら表示 */
        .req-icon.met::after,
        .req-icon.unmet::after {
            display: flex;
        }

        .req-icon.met::after {
            content: '◯';
            background-color: #28a745;
        }

        .req-icon.unmet::after {
            content: '✕';
            background-color: #dc3545;
        }

        .req-count {
            position: absolute;
            top: -0.5vh;
            right: -0.2vh;
            z-index: 2;
            color: white;
            font-weight: bold;
            font-size: 1.3vh;
            line-height: 1;
            text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
        }

        /* △△△ ここまでを置き換え △△△ */
        .skill-description {
            display: none;
            font-size: 1.14vh;
            padding: 0.474vh;
            background-color: #00000030;
            white-space: normal;
            word-wrap: break-word;
            overflow-wrap: break-word;
            word-break: break-all;
            /* 強制的に折り返す */
            overflow-y: auto;
            border-radius: 0.474vh;
            line-height: 1.5;
            max-width: 100%;
            width: 100%;
            box-sizing: border-box;
        }

        /* 特技/個性を開いたときの名前表示エリア */
        .skill-name-display {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            background-color: var(--slot-bg);
            padding: 0.474vh;
            border-bottom: 0.118vh solid var(--border-color);
            z-index: 10;
        }

        .skills-area-detail-view .skill-block.is-active .skill-name-display {
            display: flex;
            flex-direction: row;
            gap: 0.5vh;
            align-items: center;
        }

        .skill-name-display .skill-name {
            flex: 1;
        }

        .skill-name-display .skill-req-icons {
            display: flex;
            gap: 0.3vh;
        }

        .skills-area-detail-view .skill-item,
        .skills-area-detail-view .skill-block>.skill-label {
            display: none;
        }

        .skills-area-detail-view .skill-name-display .skill-label {
            display: block;
        }

        .skills-area-detail-view .skill-block:not(.is-active) {
            display: none;
        }

        .skills-area-detail-view .skill-block.is-active {
            height: 100%;
            border-bottom: none;
            display: flex;
            flex-direction: column;
            position: relative;
            padding-top: 3.5vh;
            /* 名前表示エリアの高さ分 */
        }

        .skills-area-detail-view .skill-description {
            display: block;
            flex: 1;
            overflow-y: auto;
        }

        .skills-area-detail-view {
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
        }

        .skill-description::-webkit-scrollbar {
            width: 6px;
        }

        .skill-description::-webkit-scrollbar-track {
            background: transparent;
        }

        .skill-description::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 3px;
        }

        /* ==========================================================================
            エイリアン一覧ドロワー
           ========================================================================== */
        .alien-drawer {
            position: fixed;
            top: var(--header-height);
            left: 0;
            width: 95vw;
            max-width: 42.65vh;
            height: calc(100vh - var(--header-height));
            background-color: var(--dark-bg);
            border-right: 2px solid var(--accent-green);
            transform: translateX(-100%);
            transition: transform 0.1s ease-in-out;
            z-index: 1000;
            display: flex;
            flex-direction: column;
        }

        .alien-drawer.open {
            transform: translateX(0);
        }

        .drawer-header {
            padding: 0.947vh 1.421vh;
            border-bottom: 0.118vh solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        /* ドロップゾーン（編成解除エリア） */
        .drop-zone {
            position: absolute;
            top: 100%;
            left: 15%;
            width: 70%;
            display: none;
            background: #2a2a2a;
            color: var(--light-text);
            font-size: 1.5vh;
            font-weight: bold;
            height: 3vh;
            margin-top: 0.5vh;
            text-align: center;
            border-radius: 1vh;
            transition: background 0.2s, box-shadow 0.2s;
            box-shadow: 0 0 2vh rgba(0, 0, 0, 0.8);
            z-index: 100;
        }

        .drop-zone.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .drop-zone.hover {
            background: linear-gradient(135deg, #d9534f 0%, #c9302c 100%);
            box-shadow: 0 0 2vh rgba(217, 83, 79, 0.6);
        }

        /* パーティプレビューエリア */
        .party-preview-area {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1vh 0.5vh;
            border-bottom: 0.118vh solid var(--border-color);
            background-color: #1a2a3a;
            gap: 0;
            flex-shrink: 0;
            position: relative;
        }

        .preview-arrow {
            background: var(--border-color);
            color: var(--light-text);
            border: none;
            border-radius: 0;
            width: 2.5vh;
            height: 100%;
            font-size: 1.1vh;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            -webkit-tap-highlight-color: transparent;
            flex-shrink: 0;
            margin: 0;
            padding: 1vh 0;
        }

        .preview-arrow:hover {
            background-color: #5a6a7a;
        }

        .preview-party-label {
            font-size: 1.5vh;
            font-weight: bold;
            color: var(--accent-green);
            min-width: 4vh;
            text-align: center;
            flex-shrink: 0;
            padding: 1vh 1.2vh;
        }

        .preview-slots {
            display: flex;
            gap: 0.7vh;
            flex-grow: 1;
            justify-content: center;
            padding: 0 0.8vh;
        }

        .preview-slot {
            width: 5.6vh;
            height: 5.6vh;
            border: 0.3vh solid var(--border-color);
            border-radius: 0.7vh;
            background-color: var(--slot-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
            position: relative;
            overflow: visible;
            touch-action: none;
        }

        .preview-slot.empty {
            border-style: dashed;
            cursor: default;
        }

        .preview-slot img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 0.4vh;
        }

        .preview-slot:not(.empty) {
            cursor: grab;
        }

        .preview-slot:not(.empty):active {
            cursor: grabbing;
        }

        /* 属性別の枠線色 */
        .preview-slot[data-attribute="1"] {
            border-color: #ffcccc;
        }

        .preview-slot[data-attribute="2"] {
            border-color: #c4e5a0;
        }

        .preview-slot[data-attribute="3"] {
            border-color: #c4d9ff;
        }

        .preview-slot[data-attribute="4"] {
            border-color: #e0ccff;
        }

        .preview-slot.drag-over {
            background-color: rgba(0, 255, 200, 0.2);
            border-color: var(--accent-green);
        }

        .drawer-controls,
        .sort-controls {
            display: flex;
            gap: 0.71vh;
        }

        .control-button {
            padding: 0.71vh 1.421vh;
            background-color: #f0ad4e;
            border: 0.118vh solid #eea236;
            color: var(--light-text);
            border-radius: 1.777vh;
            cursor: pointer;
            font-size: 1.658vh;
            font-weight: bold;
            -webkit-tap-highlight-color: transparent;
            transition: background-color 0.2s, border-color 0.2s;
            white-space: nowrap;
        }

        #sort-button {
            min-width: 5.5vh;
            flex-shrink: 0;
        }

        .control-button.filtered {
            background-color: #d9534f;
            border-color: #d43f3a;
        }

        .effect-tab-button.filtered {
            color: #d9534f !important;
        }

        .effect-tab-button.selected.filtered {
            background-color: #1a2a3a !important;
            border-color: #d9534f !important;
            color: #d9534f !important;
        }

        .effect-tab-button:not(.selected).filtered {
            color: #d9534f !important;
        }

        /* タブ行全体のスタイル */
        .effect-tab-row {
            background-color: #2a3a4a;
            border-radius: 0.474vh;
            margin: 0;
            padding: 0.6rem;
            margin-bottom: 0;
        }

        /* 対象帯以下の背景色を暗く（トレー風） */
        #filter-section-effects .effect-skill-header {
            background-color: #1a2a3a;
            padding: 0.6rem;
            border-radius: 0.474vh;
            margin-bottom: 0;
            margin-top: 0;
        }

        #filter-section-effects .effect-options {
            background-color: #1a2a3a;
            padding: 0 1rem 1rem 1rem;
            /* 上余白を0に */
            border-radius: 0.474vh;
            margin-top: 0;
        }

        .effect-tab-button {
            background-color: transparent;
            border: 0.118vh solid transparent;
            color: rgba(255, 255, 255, 0.7);
            transition: all 0.2s;
        }

        .effect-tab-button.selected {
            background-color: #1a2a3a !important;
            border-color: var(--accent-green);
            border-width: 0.2vh;
            font-weight: bold;
            border-radius: 0.474vh;
            position: relative;
            z-index: 2;
            color: var(--accent-green);
        }

        /* 未選択のタブのスタイル */
        .effect-tab-button:not(.selected) {
            background-color: transparent;
            border-color: transparent;
            color: rgba(255, 255, 255, 0.7);
        }

        .effect-tab-button:not(.selected):hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .sort-order-button {
            background-color: #6a7a8a;
            border-color: #5a6a7a;
        }

        .filter-menu {
            display: none;
            padding: 0.947vh;
            background-color: #1a2a3a;
            border-bottom: 0.118vh solid var(--border-color);
        }

        .effect-filter-menu {
            display: none;
            padding: 0.947vh;
            background-color: #1a2a3a;
            border-bottom: 0.118vh solid var(--border-color);
            overflow-y: auto;
        }

        .filter-row {
            display: flex;
            gap: 0.947vh;
        }

        .filter-section {
            margin-bottom: 0.947vh;
            flex: 1;
        }

        .filter-row .filter-section {
            min-width: 0;
        }

        .filter-label {
            font-size: 1.421vh;
            font-weight: bold;
            margin-bottom: 0.474vh;
            display: flex;
            align-items: center;
            gap: 0.947vh;
        }

        .filter-options {
            display: flex;
            flex-wrap: wrap;
            gap: 0.474vh;
        }

        .name-search-input {
            width: 100%;
            padding: 0.7vh 0.9vh;
            font-size: 1.4vh;
            background-color: #2a3a4a;
            border: 0.118vh solid var(--border-color);
            border-radius: 0.474vh;
            color: var(--light-text);
            box-sizing: border-box;
            min-height: 2.5vh;
        }

        .name-search-input:focus {
            outline: none;
            border-color: var(--accent-green);
        }

        .filter-button {
            background-color: transparent;
            border: none;
            padding: 0;
            cursor: pointer;
            border-radius: 0.474vh;
            -webkit-tap-highlight-color: transparent;
        }

        .filter-button img {
            width: 3.791vh;
            height: 3.791vh;
            display: block;
            opacity: 0.4;
            transition: opacity 0.2s, filter 0.2s;
        }

        .filter-button.selected img {
            opacity: 1;
            filter: drop-shadow(0 0 0.3vh var(--accent-green)) drop-shadow(0 0 0.3vh var(--accent-green));
        }

        .all-button {
            width: auto;
            padding: 0.237vh 0.947vh;
            height: auto;
            border: 0.118vh solid var(--border-color);
            border-radius: 0.474vh;
            color: var(--light-text);
            font-size: 1.3vh;
            font-weight: normal;
            background-color: #4a5a6a;
            transition: background-color 0.2s;
        }

        .all-button.selected {
            background-color: #f0ad4e;
        }

        /* 効果ボタンのスタイル */
        .effect-button {
            width: auto;
            padding: 0.35vh 1.2vh;
            height: auto;
            border: 0.118vh solid var(--border-color);
            border-radius: 0.474vh;
            color: var(--light-text);
            font-size: 1.35vh;
            font-weight: normal;
            background-color: #4a5a6a;
            transition: background-color 0.2s, border-color 0.2s;
            cursor: pointer;
            white-space: nowrap;
        }

        .effect-button:hover {
            background-color: #5a6a7a;
        }

        .effect-button.selected {
            background-color: #f0ad4e;
            border-color: var(--accent-green);
        }

        /* 個性ボタンのスタイル */
        .effect-skill-button {
            width: auto;
            padding: 0.237vh 0.947vh;
            height: auto;
            border: 0.118vh solid var(--border-color);
            border-radius: 0.474vh;
            color: var(--light-text);
            font-size: 1.2vh;
            font-weight: normal;
            background-color: #4a5a6a;
            transition: background-color 0.2s, border-color 0.2s;
            cursor: pointer;
        }

        .effect-skill-button:hover {
            background-color: #5a6a7a;
        }

        .effect-skill-button.selected {
            background-color: #f0ad4e;
            border-color: var(--accent-green);
        }

        /* バフ・デバフ見出し UI */
        .effect-main-category-title {
            display: block;
            width: 100%;
            text-align: center;
            cursor: pointer;
            user-select: none;
            position: relative;
            padding: 0.45rem 0.8rem;
            margin: 0 auto;
            box-sizing: border-box;
            background-color: #223242;
            border: 0.118vh solid var(--border-color);
            border-radius: 0.474vh;
            color: var(--accent-green);
            transition: all 0.3s ease;
            -webkit-tap-highlight-color: transparent;
        }

        /* サブカテゴリの左側の余白をメインカテゴリタイトルと同じ幅に */
        .effect-sub-category {
            padding-left: 0.8rem;
            /* effect-main-category-titleのpadding-leftと同じ */
        }

        .effect-main-category-title:active {
            background-color: #2a3a4a;
            transform: scale(0.98);
        }

        .effect-main-category-title::after {
            content: '▼';
            position: absolute;
            right: 0.6rem;
            top: 50%;
            transform: translateY(-50%);
            transition: all 0.3s ease;
        }

        .effect-main-category-title.collapsed::after {
            content: '▶';
        }

        .effect-sub-category-title {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            user-select: none;
            font-weight: 600;
            color: var(--light-text);
            transition: all 0.3s ease;
            -webkit-tap-highlight-color: transparent;
        }

        .effect-sub-category-title:active {
            color: #88ffd4;
            transform: scale(0.98);
        }

        .effect-sub-category-title::after {
            content: '▼';
            transition: all 0.3s ease;
        }

        .effect-sub-category-title.collapsed::after {
            content: '▶';
        }

        /* サブカテゴリ（トレー風） */
        .effect-sub-category {
            background-color: #1f2f3f;
            border: 0.118vh solid var(--accent-green);
            border-radius: 0.474vh;
            padding: 0.6rem;
            padding-left: 0.8rem;
            margin-bottom: 0.6rem;
            margin-left: 0;
            /* JavaScriptで設定されたmarginLeftを上書き */
        }

        .effect-buttons-container {
            margin-top: 0.35rem;
        }

        /* 折りたたみアニメーション用 */
        .effect-main-category-content {
            overflow: hidden;
            max-height: 9999px;
            opacity: 1;
            transition: max-height 0.3s ease, opacity 0.3s ease;
        }

        .effect-main-category-content.collapsed {
            max-height: 0;
            opacity: 0;
        }

        .effect-sub-category-container {
            overflow: hidden;
            max-height: 9999px;
            opacity: 1;
            transition: max-height 0.3s ease, opacity 0.3s ease;
        }

        .effect-sub-category-container.collapsed {
            max-height: 0;
            opacity: 0;
        }

        .sort-menu {
            display: none;
            position: absolute;
            top: 5.924vh;
            right: 1.421vh;
            background-color: #1a2a3a;
            border: 0.118vh solid var(--border-color);
            border-radius: 0.592vh;
            z-index: 1002;
            padding: 0.592vh;
        }

        .sort-menu button {
            display: block;
            width: 100%;
            text-align: left;
            -webkit-tap-highlight-color: transparent;
        }

        .alien-grid {
            padding: 0.947vh;
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 0.592vh;
            overflow-y: auto;
            flex-grow: 1;
            align-content: start;
        }

        .alien-card {
            text-align: center;
            cursor: pointer;
            position: relative;
            min-width: 0;
            -webkit-tap-highlight-color: transparent;
            height: fit-content;
        }

        .alien-card img {
            width: 100%;
            border: 0.237vh solid transparent;
            border-radius: 0.947vh;
            display: block;
            aspect-ratio: 1 / 1.15;
            object-fit: cover;
            object-position: center;
        }

        .alien-card:hover img {
            border-color: var(--accent-green);
        }

        .alien-name {
            display: block;
            font-size: 1.184vh;
            font-weight: bold;
            margin-top: 0.237vh;
            line-height: 1.1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 100%;
            height: fit-content;
        }

        .alien-name.invalid-data {
            color: #ff6666;
            /* 不整合データを持つエイリアンの名前を赤く表示 */
        }

        .alien-card.selected {
            filter: contrast(60%);
        }

        .alien-card.selected::after {
            content: '編成中';
            position: absolute;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 0.474vh 0.947vh;
            border-radius: 0.474vh;
            font-size: 1.303vh;
            font-weight: bold;
            white-space: nowrap;
            pointer-events: none;
        }

        .alien-card.drag-swap-target img {
            border-color: #ffc107;
            box-shadow: 0 0 1.5vh rgba(255, 193, 7, 0.8);
        }

        .drawer-toggle {
            position: fixed;
            top: 50%;
            left: 0;
            transform: translateY(-50%);
            width: 3.554vh;
            height: 7.109vh;
            background-color: var(--dark-bg);
            color: var(--light-text);
            border: 0.237vh solid var(--accent-green);
            border-left: none;
            border-radius: 0 0.947vh 0.947vh 0;
            cursor: pointer;
            z-index: 1001;
            transition: left 0.1s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
            -webkit-tap-highlight-color: transparent;
        }

        .alien-drawer {
            position: fixed;
            top: var(--header-height);
            left: 0;
            width: 95vw;
            max-width: 42.65vh;
            height: calc(100vh - var(--header-height));
            background-color: var(--dark-bg);
            border-right: 2px solid var(--accent-green);
            transform: translateX(-100%);
            transition: transform 0.1s ease-in-out;
            z-index: 1000;
            display: flex;
            flex-direction: column;
        }

        @media (min-width: 0px) {
            .alien-drawer.open+.drawer-toggle {
                left: 42.65vh;
            }
        }

        .filter-row .filter-section#filter-section-attribute {
            flex: 4;
        }

        .filter-row .filter-section#filter-section-affiliation {
            flex: 5;
        }

        .filter-row .filter-section#filter-section-attack_area {
            flex: 2;
        }

        .filter-row .filter-section#filter-section-attack_range {
            flex: 3;
        }

        .filter-row .filter-section#filter-section-role {
            flex: 2;
        }

        .filter-row .filter-section#filter-section-search {
            flex: 2.5;
            margin-right: 0.5vh;
        }

        .sort-value-display {
            position: absolute;
            bottom: 1.6vh;
            left: 0;
            right: 0;
            margin: 0 auto;
            font-size: 1.05vh;
            font-weight: bold;
            color: var(--accent-green);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            line-height: 1.4;
        }

        .sort-value-display:not(:empty) {
            background-color: rgba(0, 0, 0, 0.8);
            padding: 0.1vh 0;
        }

        .header-button {
            background: var(--border-color);
            color: var(--light-text);
            border: none;
            border-radius: 50%;
            width: 3.2vh;
            height: 3.2vh;
            font-size: 1.6vh;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            -webkit-tap-highlight-color: transparent;
        }

        .header-help-container {
            position: absolute;
            right: 1.5vh;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
        }

        .help-button-label {
            font-size: 0.9vh;
            font-weight: bold;
            margin-top: 0.2vh;
        }

        /* 管理ボタン（ヘッダー左端） */
        .header-admin-container {
            position: absolute;
            left: 1.5vh;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
        }

        .admin-button-label {
            font-size: 0.9vh;
            font-weight: bold;
            margin-top: 0.2vh;
        }

        /* リセットボタン（管理ボタンの右隣、管理モード時は非表示） */
        .header-reset-container {
            position: absolute;
            left: 6.5vh;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
        }

        .header.admin-mode .header-reset-container {
            display: none;
            /* 管理モード時は非表示 */
        }

        .header-button-wide {
            width: 4.5vh;
            /* 横長に */
        }

        .reset-button-label {
            font-size: 0.9vh;
            font-weight: bold;
            margin-top: 0.2vh;
        }

        /* P1/P2セクションリセットボタン（アリーナモード時のパーティラベル横） */
        .party-section-reset-btn {
            background: none;
            border: 1px solid var(--border-color);
            border-radius: 0.3vh;
            color: var(--light-text);
            font-size: 1.4vh;
            padding: 0.2vh 0.5vh;
            margin-left: 0.5vh;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
            transition: background-color 0.2s, border-color 0.2s;
        }

        .party-section-reset-btn:hover,
        .party-section-reset-btn:active {
            background-color: rgba(255, 136, 0, 0.3);
            border-color: #ff8800;
        }

        /* 辞書管理ボタン（管理ボタンの右隣、管理モード時のみ表示） */
        .header-dictionary-container {
            position: absolute;
            left: 6.5vh;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
            display: none;
            /* デフォルトで非表示 */
        }

        .header.admin-mode .header-dictionary-container {
            display: flex;
            /* 管理モード時のみ表示 */
        }

        .dictionary-button-label {
            font-size: 0.9vh;
            font-weight: bold;
            margin-top: 0.2vh;
        }

        /* 全体スクレイピングボタン（辞書ボタンの右隣、管理モード時のみ表示） */
        .header-scrape-container {
            position: absolute;
            left: 11.5vh;
            top: 50%;
            transform: translateY(-50%);
            display: none;
            /* デフォルトで非表示 */
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
        }

        .header.admin-mode .header-scrape-container {
            display: flex;
            /* 管理モード時のみ表示 */
        }

        .scrape-button-label {
            font-size: 0.9vh;
            font-weight: bold;
            margin-top: 0.2vh;
        }

        .header-scrape-container.active-menu .header-button {
            background: #ff8800;
            border-color: #ffb347;
        }

        .scrape-dropdown {
            position: absolute;
            top: 4.2vh;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--dark-bg);
            border: 0.237vh solid var(--accent-green);
            border-radius: 0.6vh;
            padding: 0.6vh 0;
            display: none;
            flex-direction: column;
            gap: 0.4vh;
            min-width: 16vh;
            z-index: 2001;
            box-shadow: 0 0 1vh rgba(0, 0, 0, 0.6);
        }

        .scrape-dropdown.open {
            display: flex;
        }

        .scrape-dropdown button {
            background: none;
            border: none;
            color: var(--light-text);
            text-align: left;
            padding: 0.8vh 1.2vh;
            font-size: 1.2vh;
            cursor: pointer;
            width: 100%;
        }

        .scrape-dropdown button:hover {
            background-color: rgba(255, 136, 0, 0.2);
        }

        /* アリーナモード切り替えスイッチ（一覧表示ボタンのすぐ左） */
        .header-arena-container {
            position: absolute;
            right: 11.5vh;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
        }

        .arena-toggle-wrapper {
            display: flex;
            align-items: center;
            gap: 0.3vh;
        }

        .arena-toggle {
            position: relative;
            width: 4vh;
            height: 2.2vh;
            background-color: var(--border-color);
            border-radius: 1.1vh;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .arena-toggle::after {
            content: '';
            position: absolute;
            top: 0.2vh;
            left: 0.2vh;
            width: 1.8vh;
            height: 1.8vh;
            background-color: var(--light-text);
            border-radius: 50%;
            transition: transform 0.3s ease;
        }

        .arena-toggle.active {
            background-color: #ff6b6b;
        }

        .arena-toggle.active::after {
            transform: translateX(1.8vh);
        }

        .arena-button-label {
            font-size: 0.9vh;
            font-weight: bold;
            margin-top: 0.2vh;
        }

        /* アリーナモード時のスタイル */
        body.arena-mode .arena-toggle {
            background-color: #ff6b6b;
        }

        body.arena-mode .arena-toggle::after {
            transform: translateX(1.8vh);
        }

        /* ==========================================================================
           アリーナモードのレイアウト（10スロット、5行2列）
           ========================================================================== */
        /* ==========================================================================
           アリーナモードのレイアウト（10スロット、5行2列）
           ========================================================================== */

        /* アリーナモード時のパーティコンテナ共通設定（全パーティ表示） */
        body.arena-mode .party-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: auto 1fr 1fr 1fr 1fr 1fr;
            column-gap: 0.474vh;
            row-gap: 0;
            /* ラベルとスロットをくっつけるため0に */
            height: 100%;
            padding: 0 0.5vh;
            min-width: 100%;
            box-sizing: border-box;
            grid-auto-flow: row;
        }

        /* スライダーラッパーのtransform制限を削除（通常の挙動に戻す） */
        body.arena-mode #party-slider-wrapper {
            width: 100%;
        }

        /* アリーナモード時のP1/P2ラベル（スロット結合デザイン） */
        body.arena-mode .party-label {
            font-size: 1.5vh;
            font-weight: bold;
            color: #fff;
            text-align: center;
            align-self: end;
            /* 下揃えでスロットにくっつける */
            width: 100%;
            padding: 0.3vh 0;
            margin: 0;
            border-radius: 0.5vh 0.5vh 0 0;
            /* 上部のみ角丸 */
            box-shadow: none;
            /* 背景色は個別に指定 */
        }

        body.arena-mode .party-label.p1 {
            grid-column: 2;
            grid-row: 1;
            background-color: rgba(16, 24, 39, 0.95);
        }

        body.arena-mode .party-label.p2 {
            grid-column: 1;
            grid-row: 1;
            background-color: rgba(40, 40, 60, 0.95);
            /* P2用の色（青紫系に変更） */
        }

        /* アリーナモード時、ロールアイコン（f*.webp）とプレースホルダーを非表示 */
        body.arena-mode .slot-stats-area .info-icon[src*="/icon/f"],
        body.arena-mode .slot-stats-area .icon-placeholder-small {
            display: none;
        }

        /* アリーナモード時のスロット配置制御とマージン調整 */
        body.arena-mode .party-slot {
            margin-bottom: 0.474vh;
            /* スロット間の隙間 */
        }

        /* 右列（Slot 0-4 = P1） */
        body.arena-mode .party-slot.arena-right-col {
            grid-column: 2;
            border-top-left-radius: 0;
            border-top-right-radius: 0;
        }

        /* Topのスロット（Row 2）だけ上部の角丸を消す処理が必要だが、
           全スロット共通のデザインとして結合感を出すならこれでOK。
           ただし一番下以外は四角く見える。
           一番上のスロット(Slot 0, 5)だけ border-radius-top 0 にするのが理想だが、
           ラベルが乗るので全スロットの上角丸をなくしても違和感は少ないかも。
           いや、隙間があるなら角丸あったほうがいい。
           row-gap 0 にしたのはラベルと結合するため。
           スロット同士は margin-bottom で隙間があるので、角丸保持すべき。
           -> Slot 0/5 だけ上角丸削除。
        */
        body.arena-mode .party-slot[style*="grid-row: 2"] {
            border-top-left-radius: 0;
            border-top-right-radius: 0;
        }

        /* 左列（Slot 5-9 = P2） */
        body.arena-mode .party-slot.arena-left-col {
            grid-column: 1;
            background-color: rgba(40, 40, 60, 0.95);
            /* P2背景色（青紫系に変更） */
        }

        /* ドロワープレビュー（アリーナモード時） */
        body.arena-mode #preview-slots {
            display: grid;
            grid-template-columns: auto repeat(5, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 0.5vh;
            align-items: center;
        }

        body.arena-mode .preview-slot {
            margin: 0;
            width: auto;
            height: auto;
            aspect-ratio: 1;
        }

        /* プレビュー内のP1/P2ラベル */
        body.arena-mode .preview-row-label {
            font-size: 1.2vh;
            font-weight: bold;
            color: #fff;
            text-align: center;
            padding: 0 0.5vh;
        }

        body.arena-mode .preview-row-label.p1 {
            grid-column: 1;
            grid-row: 1;
        }

        body.arena-mode .preview-row-label.p2 {
            grid-column: 1;
            grid-row: 2;
        }

        /* アリーナモード時、パーティスロット：左右2列レイアウト */
        body.arena-mode .party-slot {
            height: auto;
            display: grid;
            grid-template-columns: auto 1fr;
            grid-template-rows: auto auto auto auto;
            grid-template-areas:
                "attack skills"
                "icon skills"
                "type skills"
                "button skills";
            padding: 0.3vh;
            gap: 0.2vh 0.5vh;
        }

        /* アリーナモード時、ステータスエリアをdisplay:contentsで展開 */
        body.arena-mode .slot-stats-area {
            display: contents;
        }

        /* アリーナモード時の stats-block の調整 */
        body.arena-mode .slot-stats-area .stats-block:nth-child(3) {
            justify-content: center;
        }

        /* アリーナモード時のタイプアイコン周りのマージンリセット */
        body.arena-mode .slot-stats-area .stats-block:nth-child(3) .icon-container {
            margin: 0;
            padding: 0;
            margin-top: 0 !important;
            /* 上余白削除 */
        }

        body.arena-mode .slot-stats-area .stats-block:nth-child(3) .info-icon {
            margin: 0;
            padding: 0;
        }

        /* ロールアイコン隣接時の左マージンも強制削除 */
        body.arena-mode .slot-stats-area .stats-block:nth-child(3) img.info-icon[src*="/e"] {
            margin-left: 0 !important;
        }

        /* アリーナモード時、HP/パワーブロックを非表示 */
        body.arena-mode .stats-hp-power-block {
            display: none;
        }

        /* アリーナモード時、こうげき/所属ブロック（2番目のstats-block）を上に配置 */
        body.arena-mode .slot-stats-area .stats-block:nth-child(2) {
            grid-area: attack;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
            margin: 0;
            border: none;
            background: none;
        }

        /* アリーナモード時、タイプブロック（3番目のstats-block）を下に配置 */
        body.arena-mode .slot-stats-area .stats-block:nth-child(3) {
            grid-area: type;
            display: flex;
            justify-content: center;
            /* 中央揃えに戻す */
            align-items: center;
            padding: 0;
            margin: 0;
            border: none;
            background: none;
        }

        /* アリーナモード時、ラベルと仕切りを非表示 */
        body.arena-mode .stats-block-label,
        body.arena-mode .stats-block-divider {
            display: none;
        }

        /* アリーナモード時、情報アイコンを小さく */
        body.arena-mode .slot-stats-area .info-icon {
            width: 1.5vh;
            height: 1.5vh;
        }

        body.arena-mode .icon-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.15vh;
            justify-content: center;
        }

        /* アリーナモード時、キャラクターエリアをdisplay:contentsで展開 */
        body.arena-mode .slot-character-area {
            display: contents;
        }

        /* アリーナモード時、名前を非表示 */
        body.arena-mode .slot-character-name {
            display: none;
        }

        /* アリーナモード時、編成前のプレースホルダー */
        body.arena-mode .slot-character-icon-placeholder {
            grid-area: icon;
            min-width: 7vh;
            min-height: 7vh;
            cursor: pointer;
        }

        /* アリーナモード時、編成後のアイコン */
        body.arena-mode .slot-character-icon {
            grid-area: icon;
            max-width: 7vh;
            max-height: 7vh;
        }

        /* アリーナモード時、編成解除ボタン */
        body.arena-mode .remove-button {
            grid-area: button;
            font-size: 0.8vh;
            padding: 0.2vh 0.3vh;
            cursor: pointer;
        }

        /* アリーナモード時、スキルエリア */
        body.arena-mode .slot-skills-area {
            grid-area: skills;
            max-height: 14vh;
            overflow-y: auto;
        }


        /* 一覧表示ボタン（使い方ボタンのすぐ左） */
        .header-overview-container {
            position: absolute;
            right: 6.5vh;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
        }

        .overview-button-label {
            font-size: 0.9vh;
            font-weight: bold;
            margin-top: 0.2vh;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .modal-content {
            background: var(--dark-bg);
            padding: 2.5vh;
            border-radius: 1vh;
            border: 0.2vh solid var(--accent-green);
            width: 90%;
            max-width: 45vh;
            color: var(--light-text);
        }

        .modal-content h2 {
            text-align: center;
            margin-top: 0;
            font-size: 1.5em;
        }

        .modal-content ol {
            padding-left: 2.5vh;
        }

        .modal-content li {
            margin-bottom: 1.2vh;
            line-height: 1.5;
        }

        .modal-content #close-modal-button {
            display: block;
            margin: 1.5vh auto 0;
            background-color: #6a7a8a;
            border-color: #5a6a7a;
        }

        .modal-overview {
            font-size: 1.3vh;
            line-height: 1.6;
            margin-bottom: 2vh;
            text-align: center;
        }

        .modal-links {
            margin-top: 2.5vh;
            font-size: 1.4vh;
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 0.3vh;
            align-items: center;
        }

        .modal-links a {
            color: var(--accent-green);
            text-decoration: none;
        }

        .modal-links p {
            margin: 0;
            line-height: 1.4;
        }

        .modal-links button {
            width: 100%;
            max-width: 26vh;
            font-size: 1.3vh;
            margin: 0.2vh 0 0;
        }

        .scrape-modal-content {
            background: var(--dark-bg);
            padding: 2vh;
            border-radius: 1vh;
            border: 0.2vh solid var(--accent-green);
            width: 90%;
            max-width: 40vh;
            color: var(--light-text);
            display: flex;
            flex-direction: column;
            gap: 1.2vh;
        }

        .scrape-modal-content h3 {
            margin: 0;
            font-size: 1.6vh;
        }

        .scrape-modal-content p {
            margin: 0;
            font-size: 1.3vh;
            line-height: 1.6;
        }

        .scrape-modal-content input {
            width: 100%;
            padding: 0.9vh;
            font-size: 1.4vh;
            background-color: var(--dark-bg);
            border: 0.2vh solid var(--border-color);
            border-radius: 0.6vh;
            color: var(--light-text);
        }

        .scrape-modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1vh;
        }

        .scrape-modal-error {
            color: #ff6666;
            font-size: 1.2vh;
            min-height: 1.6vh;
        }

        /* ヘルプモーダル ページネーション */
        .modal-content {
            display: flex;
            flex-direction: column;
            height: 70vh;
            max-height: 70vh;
            overflow: hidden;
        }

        .help-content-wrapper {
            flex: 1;
            overflow-y: auto;
            min-height: 0;
            max-height: 100%;
        }

        .help-page {
            font-size: 1.4vh;
        }

        .help-page h3 {
            font-size: 1.3em;
            margin-top: 1.5vh;
            margin-bottom: 0.8vh;
            border-bottom: 0.118vh solid var(--border-color);
            padding-bottom: 0.5vh;
        }

        .help-page h4 {
            font-size: 1.1em;
            margin-top: 1.2vh;
            margin-bottom: 0.6vh;
            color: var(--accent-green);
        }

        .help-page ul,
        .help-page ol {
            font-size: 1.4vh;
            line-height: 1.5;
        }

        .help-page li {
            margin-bottom: 0.8vh;
        }

        .help-page p {
            font-size: 1.4vh;
            line-height: 1.5;
            margin-bottom: 1vh;
        }

        .help-pagination {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 2.5vh;
            margin-bottom: 1.5vh;
            gap: 1vh;
        }

        .help-pagination button {
            min-width: 8vh;
        }

        .help-page-dots {
            display: flex;
            gap: 0.5vh;
            align-items: center;
        }

        .help-page-dot {
            width: 0.8vh;
            height: 0.8vh;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.3);
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .help-page-dot.active {
            background-color: var(--accent-green);
        }

        .help-page-dot:hover {
            background-color: rgba(255, 255, 255, 0.5);
        }

        #help-page-indicator {
            font-size: 1.4vh;
            color: var(--light-text);
        }

        #help-prev-button:disabled,
        #help-next-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .modal-links a:hover {
            text-decoration: underline;
        }

        /* ==========================================================================
            パーティセレクター と ドラッグ＆ドロップ
           ========================================================================== */
        .party-selector {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 2vh;
            margin: 0.947vh 0;
            height: 3vh;
            flex-shrink: 0;
        }

        .party-nav-button {
            background: none;
            border: none;
            color: var(--light-text);
            font-size: 2vh;
            cursor: pointer;
            padding: 0 1.5vh;
            touch-action: manipulation;
        }

        .party-nav-button:disabled {
            opacity: 0.3;
            cursor: default;
        }

        .party-dots {
            display: flex;
            gap: 1.5vh;
        }

        .dot {
            width: 1.2vh;
            height: 1.2vh;
            border-radius: 50%;
            background-color: var(--border-color);
            transition: background-color 0.2s;
            cursor: pointer;
        }

        .dot.active {
            background-color: var(--accent-green);
        }

        /* 編成履歴エリア */
        .formation-history {
            display: flex;
            align-items: center;
            gap: 0.5vh;
            padding: 0.5vh 1vh;
            overflow-x: auto;
            overflow-y: hidden;
            height: 5.5vh;
            flex-shrink: 0;
            /* 編成スロットと同じ幅に制限 */
            width: 95vw;
            max-width: 42.65vh;
            margin: 0.3vh auto;
            /* 枠線とベース背景 */
            border: 0.118vh dashed var(--border-color);
            border-radius: 0.474vh;
            background-color: rgba(0, 0, 0, 0.2);
            box-sizing: border-box;
        }

        /* PCではスクロールバーを薄く表示（マウスホイールでスクロール可能） */
        .formation-history::-webkit-scrollbar {
            height: 0.4vh;
        }

        .formation-history::-webkit-scrollbar-track {
            background: transparent;
        }

        .formation-history::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 0.2vh;
        }

        .formation-history {
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 255, 255, 0.3) transparent;
        }

        .formation-history .alien-card {
            /* 履歴エリアの高さからパディング分を引いた高さ */
            height: calc(5.5vh - 1vh) !important;
            width: auto !important;
            min-width: calc(5.5vh - 1vh);
            flex-shrink: 0;
        }

        .formation-history .alien-card img {
            height: 100% !important;
            width: auto !important;
            aspect-ratio: 1 / 1;
            border-radius: 0.5vh;
        }

        .formation-history .alien-name,
        .formation-history .sort-value-display {
            display: none !important;
        }

        /* 履歴内の「編成中」テキストをアイコンサイズに合わせて縮小 */
        .formation-history .alien-card.selected::after {
            font-size: 0.8vh !important;
            padding: 0.15vh 0.3vh !important;
        }

        /* 履歴が空のときのプレースホルダー */
        .formation-history-placeholder {
            color: var(--light-text);
            font-size: 1.2vh;
            opacity: 0.6;
            white-space: nowrap;
        }

        /* コンパクト版パーティセレクター */
        .party-selector-compact {
            height: 2vh;
            margin: 0 !important;
            gap: 1.5vh;
        }

        .party-selector-compact .party-nav-button {
            font-size: 1.5vh;
            padding: 0 1vh;
        }

        .party-selector-compact .party-dots {
            gap: 1vh;
        }

        .party-selector-compact .dot {
            width: 0.9vh;
            height: 0.9vh;
        }

        .party-slot.drag-over {
            border-color: #f0ad4e;
            transform: scale(1.02);
        }

        /* 通常モードのOverviewスロット */
        .overview-party-slots {
            display: flex;
            align-items: center;
            flex-grow: 1;
        }

        /* アリーナモードのサブパーティコンテナ (P1/P2) */
        .overview-sub-party {
            display: flex;
            align-items: center;
            flex-grow: 1;
            padding: 0.2vh;
            border-radius: 0.5vh;
            /* ハイライト時の見栄え用 */
            transition: all 0.2s;
        }

        /* アリーナモードのOverviewラッパー */
        .overview-arena-container {
            display: flex;
            flex-direction: column;
            gap: 0.5vh;
            width: 100%;
        }

        .overview-mini-slot {
            width: 4vh;
            height: 4vh;
            background-color: rgba(0, 0, 0, 0.3);
            border: 0.1vh solid rgba(255, 255, 255, 0.2);
            margin-right: 0.5vh;
            border-radius: 0.5vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
        }

        .overview-mini-slot.empty {
            opacity: 0.5;
        }

        .overview-party-row.drag-over,
        .overview-sub-party.drag-over {
            box-shadow: 0 0 0.5vh var(--accent-green);
            transform: scale(1.02);
            transition: all 0.2s;
            background-color: rgba(255, 255, 255, 0.1);
        }

        .slot-icon {
            -webkit-user-drag: element;
        }

        .icon-placeholder.drag-over {
            border-color: #f0ad4e;
            transform: scale(1.02);
        }

        /* ==========================================================================
            長押しプレビュー機能
           ========================================================================== */
        #preview-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 95vw;
            max-width: 42.65vh;
            height: 100vh;
            background: rgba(0, 0, 0, 0.85);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }

        #preview-overlay.active {
            display: flex;
        }

        #preview-slot-container {
            width: 90%;
            max-width: 38.385vh;
            /* 42.65vh * 0.9 */
            background-color: var(--slot-bg);
            border: 0.237vh solid var(--accent-green);
            border-radius: 0.947vh;
            padding: 0.947vh;
            position: relative;
            z-index: 3001;
        }

        #preview-slot-container .party-container {
            display: flex;
            flex-direction: column;
            gap: 0.947vh;
        }

        /* 長押しプレビューでアリーナスタイルレイアウトを適用（統一UI） */
        #preview-slot-container .party-slot {
            height: 18vh;
            min-height: 18vh;
            max-height: 18vh;
            display: grid;
            grid-template-columns: 7vh 1fr;
            grid-template-rows: 3.5vh 7vh 3.5vh auto;
            grid-template-areas:
                "type skills"
                "icon skills"
                "attack skills"
                "button skills";
            padding: 0.5vh;
            gap: 0.3vh 0.8vh;
            overflow: hidden;
        }

        #preview-slot-container .slot-stats-area {
            display: contents;
        }

        /* HP/パワーブロックを非表示 */
        #preview-slot-container .stats-hp-power-block {
            display: none;
        }

        /* こうげき/所属ブロック（2番目のstats-block）を下に配置 */
        #preview-slot-container .slot-stats-area .stats-block:nth-child(2) {
            grid-area: attack;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
            margin: 0;
            border: none;
            background: none;
            width: 7vh;
        }

        /* こうげき/所属アイコンを大きく（エイリアンアイコンと同じ横幅） */
        #preview-slot-container .slot-stats-area .stats-block:nth-child(2) .icon-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.3vh;
            width: 100%;
        }

        #preview-slot-container .slot-stats-area .stats-block:nth-child(2) .info-icon {
            width: 2.2vh;
            height: 2.2vh;
        }

        /* タイプブロック（3番目のstats-block）を上に配置 */
        #preview-slot-container .slot-stats-area .stats-block:nth-child(3) {
            grid-area: type;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
            margin: 0;
            border: none;
            background: none;
            width: 7vh;
        }

        /* タイプアイコンを2×2グリッドで配置 */
        #preview-slot-container .slot-stats-area .stats-block:nth-child(3) .icon-container {
            display: grid;
            grid-template-columns: repeat(2, 1.6vh);
            grid-template-rows: repeat(2, 1.6vh);
            gap: 0.15vh;
            justify-content: center;
            align-content: center;
            margin: 0 !important;
            padding: 0 !important;
            padding-bottom: 0.3vh !important;
        }

        #preview-slot-container .slot-stats-area .stats-block:nth-child(3) .info-icon {
            width: 1.6vh;
            height: 1.6vh;
            margin: 0 !important;
            padding: 0 !important;
        }

        /* ラベルと仕切りを非表示 */
        #preview-slot-container .stats-block-label,
        #preview-slot-container .stats-block-divider {
            display: none;
        }

        /* ロールアイコンとプレースホルダーを非表示 */
        #preview-slot-container .slot-stats-area .info-icon[src*="/icon/f"],
        #preview-slot-container .slot-stats-area .icon-placeholder-small {
            display: none;
        }

        /* ロールアイコン隣接時の左マージンを強制削除 */
        #preview-slot-container .slot-stats-area img.info-icon[src*="/e"] {
            margin-left: 0 !important;
        }


        /* キャラクターエリアをdisplay:contentsで展開 */
        #preview-slot-container .slot-character-area {
            display: contents;
        }

        /* 名前を非表示 */
        #preview-slot-container .slot-character-name {
            display: none;
        }

        /* 編成後のアイコン（少し下に配置） */
        #preview-slot-container .slot-character-icon {
            grid-area: icon;
            width: 7vh;
            height: 7vh;
            max-width: 7vh;
            max-height: 7vh;
            align-self: end;
        }

        /* 編成解除ボタン */
        #preview-slot-container .remove-button {
            grid-area: button;
            font-size: 0.8vh;
            padding: 0.2vh 0.3vh;
            cursor: pointer;
            display: none;
        }

        /* スキルエリア（固定サイズでスクロール） */
        #preview-slot-container .slot-skills-area {
            grid-area: skills;
            height: 100%;
            max-height: 100%;
            overflow-y: auto;
        }

        /* 一覧表示オーバーレイ */
        #party-overview-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }

        #party-overview-overlay.active {
            display: flex;
        }

        /* パスワード入力モーダル（一覧表示と同じスタイル） */
        #password-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }

        #password-modal-overlay.active {
            display: flex;
        }

        #password-modal-container {
            width: auto;
            max-width: 90vw;
            background-color: var(--slot-bg);
            border: 0.237vh solid var(--accent-green);
            border-radius: 0.947vh;
            padding: 2vh;
            color: var(--light-text);
        }

        #password-modal-container h2 {
            text-align: center;
            margin-top: 0;
            margin-bottom: 1.5vh;
        }

        #password-modal-container input {
            width: 100%;
            padding: 1vh;
            background-color: var(--dark-bg);
            border: 0.237vh solid var(--border-color);
            border-radius: 0.5vh;
            color: var(--light-text);
            font-size: 1.5vh;
            margin-bottom: 1.5vh;
        }

        #password-modal-container button {
            width: 100%;
            padding: 1vh;
            background-color: var(--border-color);
            border: 0.237vh solid var(--accent-green);
            border-radius: 0.5vh;
            color: var(--light-text);
            font-size: 1.5vh;
            cursor: pointer;
        }

        #password-modal-container button:hover {
            background-color: #5a6a7a;
        }

        #password-modal-container .error-message {
            color: #ff6666;
            font-size: 1.2vh;
            margin-top: 0.5vh;
            min-height: 1.6vh;
            visibility: hidden;
        }

        #password-modal-container .error-message.show {
            visibility: visible;
        }

        #party-overview-container {
            width: auto;
            max-width: 90vw;
            background-color: var(--slot-bg);
            border: 0.237vh solid var(--accent-green);
            border-radius: 0.947vh;
            padding: 1.5vh;
            max-height: 85vh;
            overflow-y: auto;
        }

        .overview-party-row {
            display: flex;
            align-items: center;
            gap: 0.947vh;
            margin-bottom: 1.2vh;
            padding: 0.6vh;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 0.474vh;
            width: fit-content;
        }

        .overview-party-label {
            font-weight: bold;
            font-size: 1.8vh;
            min-width: 4vh;
            text-align: center;
            cursor: grab;
            user-select: none;
            -webkit-user-select: none;
        }

        .overview-party-label:active {
            cursor: grabbing;
        }

        .overview-party-slots {
            display: flex;
            gap: 0.474vh;
        }

        /* アリーナモード時のOverviewスロットレイアウト */
        body.arena-mode .overview-party-slots {
            display: grid;
            grid-template-columns: auto repeat(5, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 0.5vh;
            align-items: center;
        }

        /* Overview内の行ラベル（P1/P2） */
        body.arena-mode .overview-row-label {
            font-size: 1.2vh;
            font-weight: bold;
            color: #fff;
            padding: 0 0.5vh;
            text-align: center;
        }

        body.arena-mode .overview-row-label.p1 {
            grid-column: 1;
            grid-row: 1;
        }

        body.arena-mode .overview-row-label.p2 {
            grid-column: 1;
            grid-row: 2;
        }

        .overview-mini-slot {
            width: 5.6vh;
            height: 5.6vh;
            border: 0.237vh solid var(--border-color);
            border-radius: 0.474vh;
            background-color: var(--dark-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .overview-mini-slot img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .overview-mini-slot.empty {
            background-color: rgba(0, 0, 0, 0.5);
        }

        .overview-mini-slot[data-attribute="1"] {
            border-color: #ffcccc;
        }

        .overview-mini-slot[data-attribute="2"] {
            border-color: #c4e5a0;
        }

        .overview-mini-slot[data-attribute="3"] {
            border-color: #c4d9ff;
        }

        .overview-mini-slot[data-attribute="4"] {
            border-color: #e0ccff;
        }

        .overview-party-row.drag-over {
            background-color: rgba(255, 255, 0, 0.2);
            border: 0.237vh dashed var(--accent-green);
        }
    </style>
</head>

<body>
    <!-- ローディング画面 -->
    <div id="loading-overlay">
        <div>
            <p>エリたま編成ジェネレーター</p>
            <p id="loading-message">読み込み中...</p>
        </div>
    </div>

    <!-- メインコンテンツ -->
    <div id="main-content">
        <!-- ヘッダー -->
        <header class="header" id="main-header">
            <div class="header-admin-container">
                <button id="admin-button" class="header-button">管</button>
                <div class="admin-button-label">管理</div>
            </div>
            <div class="header-reset-container">
                <button id="reset-button" class="header-button header-button-wide">↺</button>
                <div class="reset-button-label">リセット</div>
            </div>
            <div class="header-dictionary-container">
                <button id="dictionary-button" class="header-button">辞</button>
                <div class="dictionary-button-label">辞書</div>
            </div>
            <div class="header-scrape-container">
                <button id="scrape-button" class="header-button" aria-haspopup="true" aria-expanded="false">実</button>
                <div class="scrape-button-label">実行</div>
                <div class="scrape-dropdown" id="scrape-dropdown" role="menu">
                    <button type="button" data-action="full" role="menuitem">全体スクレイピング</button>
                    <button type="button" data-action="partial" role="menuitem">部分スクレイピング</button>
                </div>
            </div>
            <div class="header-arena-container" id="arena-container">
                <div class="arena-toggle-wrapper">
                    <div class="arena-toggle" id="arena-toggle"></div>
                </div>
                <div class="arena-button-label">アリーナ</div>
            </div>
            <div class="header-overview-container">
                <button id="overview-button" class="header-button">一</button>
                <div class="overview-button-label">一覧表示</div>
            </div>
            <div class="header-title-container">
                <span id="header-title">エリジェネ</span>
                <img src="/static/main_icon.webp" alt="エリジェネアイコン" class="header-title-icon">
            </div>
            <div class="header-help-container">
                <button id="help-button" class="header-button">？</button>
                <div class="help-button-label">使い方</div>
            </div>
        </header>

        <!-- 編成履歴エリア -->
        <div class="formation-history" id="formation-history">
            <!-- JSで動的生成 -->
        </div>

        <div class="layout-wrapper">
            <div class="main-container" id="main-container">
                <div class="party-display-area" id="party-display">
                    <div id="party-slider-wrapper">
                        <div id="party-container-1" class="party-container"></div>
                        <div id="party-container-2" class="party-container"></div>
                        <div id="party-container-3" class="party-container"></div>
                        <div id="party-container-4" class="party-container"></div>
                        <div id="party-container-5" class="party-container"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- パーティ切り替えセレクター（コンパクト版） -->
        <div class="party-selector party-selector-compact">
            <button id="prev-party-btn" class="party-nav-button">◀</button>
            <div id="party-dots" class="party-dots">
                <span class="dot active" data-party-id="1"></span>
                <span class="dot" data-party-id="2"></span>
                <span class="dot" data-party-id="3"></span>
                <span class="dot" data-party-id="4"></span>
                <span class="dot" data-party-id="5"></span>
            </div>
            <button id="next-party-btn" class="party-nav-button">▶</button>
        </div>

        <!-- エイリアン一覧ドロワー -->
        <div class="alien-drawer" id="alien-drawer">
            <div class="drawer-header">
                <div class="drawer-controls">
                    <button class="control-button" id="effect-filter-button">バフ・デバフ▼</button>
                    <button class="control-button" id="filter-button">絞り込み▼</button>
                </div>
                <div class="sort-controls">
                    <button class="control-button" id="sort-button">ID</button>
                    <button class="control-button sort-order-button" id="sort-order-button">降順</button>
                </div>
            </div>

            <div class="sort-menu" id="sort-menu">
                <button class="control-button" data-sort-key="id">ID</button>
                <button class="control-button" data-sort-key="attribute">属性</button>
                <button class="control-button" data-sort-key="affiliation">所属</button>
                <button class="control-button" data-sort-key="hp">たいりょく</button>
                <button class="control-button" data-sort-key="power">つよさ</button>
                <button class="control-button" data-sort-key="motivation">やるき</button>
                <button class="control-button" data-sort-key="size">おおきさ</button>
                <button class="control-button" data-sort-key="speed">いどう</button>
                <button class="control-button" data-sort-key="attack_area">攻撃はんい</button>
                <button class="control-button" data-sort-key="attack_range">攻撃きょり</button>
            </div>
            <div class="effect-filter-menu" id="effect-filter-menu">
                <div class="filter-section" id="filter-section-effects"></div>
            </div>
            <div class="filter-menu" id="filter-menu">
                <div class="filter-row">
                    <div class="filter-section" id="filter-section-attribute"></div>
                    <div class="filter-section" id="filter-section-affiliation"></div>
                </div>
                <div class="filter-row">
                    <div class="filter-section" id="filter-section-attack_area"></div>
                    <div class="filter-section" id="filter-section-attack_range"></div>
                </div>
                <div class="filter-section" id="filter-section-types"></div>
                <div class="filter-row">
                    <div class="filter-section" id="filter-section-role"></div>
                    <div class="filter-section" id="filter-section-search">
                        <div class="filter-label">
                            <span>名前検索欄</span>
                            <button class="filter-button all-button" id="search-reset-button">リセット</button>
                        </div>
                        <div class="filter-options">
                            <input type="text" id="name-search-input" class="name-search-input" placeholder="エイリアン名を入力">
                        </div>
                    </div>
                </div>
            </div>

            <!-- パーティプレビューエリア -->
            <div class="party-preview-area" id="party-preview-area">
                <button class="preview-arrow preview-arrow-left" id="preview-arrow-left">◀</button>
                <div class="preview-party-label" id="preview-party-label">P1</div>
                <div class="preview-slots" id="preview-slots">
                    <!-- JavaScriptで動的に生成 -->
                </div>
                <button class="preview-arrow preview-arrow-right" id="preview-arrow-right">▶</button>

                <!-- ドロップゾーン（編成解除エリア） -->
                <div class="drop-zone" id="drop-zone">
                    編成解除
                </div>
            </div>

            <div class="alien-grid" id="alien-grid">
                {% for alien in aliens %}
                <div class="alien-card" data-id="{{ alien.id }}" data-name="{{ alien.name }}"
                    data-skill_no1_name="{{ alien.skill_no1 }}" data-skill_no2_name="{{ alien.skill_no2 }}"
                    data-skill_no3_name="{{ alien.skill_no3 }}" data-info-a="{{ alien.attribute }}"
                    data-info-b="{{ alien.affiliation }}" data-info-c="{{ alien.attack_area }}"
                    data-info-d="{{ alien.attack_range }}" data-info-f="{{ alien.role }}"
                    data-info-e1="{{ alien.type_1 }}" data-info-e2="{{ alien.type_2 }}"
                    data-info-e3="{{ alien.type_3 }}" data-info-e4="{{ alien.type_4 }}" title="{{ alien.name }}">
                    <img src="/static/images/{{ alien.id }}.webp" alt="{{ alien.name }}">
                    <div class="sort-value-display"></div>
                    <div class="alien-name">{{ alien.name }}</div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- ドロワー開閉ボタン -->
        <button class="drawer-toggle" id="drawer-toggle">▶</button>

        <!-- パーティ一覧表示オーバーレイ -->
        <div id="party-overview-overlay">
            <div id="party-overview-container">
                <!-- JavaScriptで動的に生成 -->
            </div>
        </div>

        <!-- 変更適応メッセージ表示オーバーレイ -->
        <div id="apply-changes-overlay"
            style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.85); display: none; align-items: center; justify-content: center; z-index: 3000;">
            <div id="apply-changes-container"
                style="width: auto; max-width: 90vw; background-color: var(--slot-bg); border: 0.237vh solid var(--accent-green); border-radius: 0.947vh; padding: 1.5vh; max-height: 85vh; overflow-y: auto;">
                <div id="apply-changes-content"></div>
            </div>
        </div>

        <!-- パスワード入力モーダル -->
        <div id="password-modal-overlay">
            <div id="password-modal-container">
                <h2>管理モード</h2>
                <input type="password" id="password-input" placeholder="パスワードを入力">
                <div class="error-message" id="password-error">パスワードが正しくありません</div>
                <button id="password-submit-button">ログイン</button>
                <button id="password-cancel-button"
                    style="margin-top: 1vh; background-color: #6a7a8a; border-color: #5a6a7a;">キャンセル</button>
            </div>
        </div>

        <!-- 長押しプレビューオーバーレイ -->
        <div id="preview-overlay">
            <div id="preview-slot-container">
                <!-- プレビュースロットのHTMLをJavaScriptで動的生成 -->
            </div>
        </div>

        <!-- ヘルプモーダル -->
        <div id="help-modal" class="modal-overlay">
            <div class="modal-content">
                <div class="help-content-wrapper">
                    <!-- ページ1: 基本情報・概要 -->
                    <div class="help-page" data-page="1">
                        <h2>エリジェネとは</h2>
                        <p class="modal-overview">
                            このツールは「エイリアンのたまご(エリたま)」の編成支援ジェネレーターです。チームに加えたエイリアンの個性発動条件が満たされているかをリアルタイムでシミュレーションできます。
                        </p>
                        <h3>主な機能</h3>
                        <ul>
                            <li>最大5パーティまで編成を作成可</li>
                            <li>個性の発動条件をリアルタイムで判定・表示</li>
                            <li>エイリアンの絞り込み・並び替え機能</li>
                            <li>効果（バフ・デバフ）による検索機能</li>
                            <li>ドラッグ&ドロップでの編成操作</li>
                        </ul>
                        <div class="modal-links">
                            <p><a href="https://twitter.com/by_kanikama" target="_blank"
                                    rel="noopener noreferrer">制作者X</a></p>
                            <p><a href="https://discord.gg/bq5E38HUec" target="_blank"
                                    rel="noopener noreferrer">エリたまDiscord</a>（誰でも歓迎！）</p>
                            <p><a href="https://github.com/fuyuyu0111/elitama-generator" target="_blank"
                                    rel="noopener noreferrer">GitHubリポジトリ</a>(ソースコード)</p>
                            <button id="install-app-button" class="control-button" type="button"
                                style="display: none;">ホームに追加</button>
                            <button id="open-bug-report-button" class="control-button" type="button">不具合報告フォームへ</button>
                        </div>
                    </div>

                    <!-- ページ2: 編成の方法 -->
                    <div class="help-page" data-page="2" style="display: none;">
                        <h2>編成の方法</h2>
                        <h3>エイリアンを編成に追加する</h3>
                        <ul>
                            <li><strong>エイリアン一覧を開く</strong>：空のスロット（破線枠）または右側の▶ボタンをタップして、エイリアン一覧ドロワーを開きます</li>
                            <li><strong>エイリアンを選択</strong>：一覧から編成したいエイリアンをタップします</li>
                            <li>編成に追加されると、スロットにエイリアンのアイコンが表示されます</li>
                        </ul>

                        <h3>エイリアンを編成から外す</h3>
                        <ul>
                            <li><strong>方法1</strong>：編成画面で、エイリアンアイコン下の「編成解除」ボタンをタップします</li>
                            <li><strong>方法2</strong>：エイリアン一覧画面下部の「編成解除」エリアに、エイリアンをドラッグ&ドロップします</li>
                        </ul>

                        <h3>ドラッグ&ドロップで入れ替え</h3>
                        <ul>
                            <li>編成済みのエイリアンをドラッグして、別のスロットにドロップすると移動できます</li>
                            <li>一覧画面では編成しているエイリアンから入れ替えたいエイリアンへ<strong>直接ドラッグ&ドロップで入れ替えられます</strong></li>
                        </ul>

                        <h3>編成履歴</h3>
                        <ul>
                            <li>編成した順に最新20体分の履歴が表示されます</li>
                            <li>表示されるアイコンは一覧画面と同じ様に機能し、タップで編成/編成解除ができます</li>
                        </ul>
                    </div>

                    <!-- ページ3: パーティの入れ替え -->
                    <div class="help-page" data-page="3" style="display: none;">
                        <h2>パーティの入れ替え</h2>
                        <ul>
                            <li>◀▶ボタンまたは画面下部のドット（●）をタップしてパーティを切り替えます</li>
                            <li>スマホならフリック、PCならスクロールでパーティを切り替えられます</li>
                            <li>スマホの場合、一覧画面のパーティ番号(P1、P2など)をフリックしても切り替えられます</li>
                        </ul>

                        <h3>パーティ自体の入れ替え</h3>
                        <ul>
                            <li>「使い方」の左の「一覧表示」ボタンをタップして、全パーティの一覧を表示します</li>
                            <li>一覧表示では、パーティ番号（P1、P2など）をドラッグして別のパーティと入れ替えできます</li>
                            <li>スクショを取ってパーティを共有するときなどに便利です</li>
                        </ul>
                    </div>

                    <!-- ページ4: アリーナモード -->
                    <div class="help-page" data-page="4" style="display: none;">
                        <h2>アリーナモード</h2>
                        <p class="modal-overview">
                            画面上部のアリーナボタンで、通常モードとアリーナモードを切り替えられます。
                        </p>
                        <h3>アリーナモードの特徴</h3>
                        <ul>
                            <li><strong>10体編成</strong>：P1とP2の計10体を同時に作成できます</li>
                            <li><strong>リアルタイム判定</strong>：P1とP2はそれぞれ独立して個性の発動条件を判定します</li>
                            <li><strong>配置</strong>：一覧画面などでは、P1とP2が上下に分かれて表示されます</li>
                            <li><strong>データ保持</strong>：アリーナモードから通常モードに戻しても、P2の編成内容は消えずに保持されます</li>
                        </ul>

                        <h3>アリーナモードでの入れ替え</h3>
                        <ul>
                            <li>一覧表示画面では、「1-P1」「1-P2」のようなラベルやブロックをドラッグして、P1/P2単位で個別に入れ替えられます</li>
                            <li>通常モードと同様、ドラッグ中に入れ替え対象がハイライト表示されます</li>
                            <li>入れ替えにより同じパーティ内で重複が発生した場合、P1側のエイリアンが優先して残ります</li>
                        </ul>
                    </div>

                    <!-- ページ5: 要求の説明 -->
                    <div class="help-page" data-page="5" style="display: none;">
                        <h2>個性発動条件（要求）について</h2>
                        <p class="modal-overview">
                            個性スロットにアイコンが表示されている場合、効果を発動するための編成要求があることを示します
                        </p>

                        <h3>リアルタイム判定</h3>
                        <ul>
                            <li>編成を変更すると、全ての個性の要求判定が自動的に更新されます</li>
                            <li>条件を満たすと◯、満たさないと✕が表示されます</li>
                        </ul>

                        <h3>要求数の表示</h3>
                        <ul>
                            <li>要求数が2以上の場合、要求アイコン右上に数字で表示されます</li>
                            <li>例：右上に「2」と表示されている場合、味方にその条件を満たすエイリアンが2体以上必要です</li>
                        </ul>

                        <h3>「以外」の表示</h3>
                        <ul>
                            <li>アイコンが逆さまになっている場合、そのアイコン以外の要求を示します</li>
                            <li>例：逆さまの昆虫アイコンの場合、「昆虫属性以外」という意味です</li>
                        </ul>
                    </div>

                    <!-- ページ6: 一覧画面の機能 -->
                    <div class="help-page" data-page="6" style="display: none;">
                        <h2>一覧画面の機能</h2>

                        <h3>バフ・デバフ</h3>
                        <p>エイリアン一覧画面の「バフ・デバフ▼」ボタンから、個性や特技に含まれる効果で絞り込めます。詳しくは次ページを参照してください。</p>

                        <h3>絞り込み</h3>
                        <p>エイリアン一覧画面の「絞り込み▼」ボタンから、ゲーム内と同じ基本情報でエイリアンを絞り込めます。ゲーム内と同じ様に、各項目のアイコンをタップして切り替え可能です。デフォルトではすべて表示になっており、一つでも変更があると絞り込みボタンが赤くなります。複数の項目を組み合わせて絞り込むと、<strong>AND検索</strong>になります。
                        </p>

                        <h3>名前検索</h3>
                        <p>エイリアン一覧画面の「絞り込み▼」ボタンから開く画面の「名前検索欄」で、エイリアン名による検索ができます。ひらがな・カタカナ・英字の全角・半角・大文字・小文字は区別されません。一文字でも入力されていれば絞り込みボタンが赤くなります。「リセット」ボタンで検索をクリアできます。
                        </p>

                        <h3>並び替え</h3>
                        <p>「ID」「属性」「所属」「たいりょく」「こうげき」「やるき」「おおきさ」「いどう」「攻撃はんい」「攻撃きょり」で並び替えられます。「降順」ボタンで昇順/降順を切り替えられます。</p>

                        <h3>アイコン長押しプレビュー</h3>
                        <p>エイリアン一覧画面で、エイリアンのアイコンを長押しすると、そのエイリアンを現在のパーティに追加した場合のプレビューが表示されます。プレビューでは個性の発動条件がリアルタイムで判定され、スキルの詳細も確認できます。
                        </p>
                    </div>

                    <!-- ページ7: バフ・デバフ絞り込み -->
                    <div class="help-page" data-page="7" style="display: none;">
                        <h2>バフ・デバフ絞り込み</h2>

                        <h3>タブの切り替え</h3>
                        <ul>
                            <li><strong>個性タブ</strong>：個性1〜3の効果で絞り込みます</li>
                            <li><strong>特技タブ</strong>：特技の効果で絞り込みます</li>
                        </ul>

                        <h3>AND/OR検索</h3>
                        <ul>
                            <li><strong>OR検索</strong>：選択した効果のいずれかを持つエイリアンを表示します</li>
                            <li><strong>AND検索</strong>：選択した効果をすべて持つエイリアンを表示します</li>
                            <li>個性・特技タブそれぞれとタブ間の関係を切り替えられます</li>
                            <li>例：「毒アタック」または「毒キラー」を持っており、特技は「毒付与」のエイリアンを絞り込みたいときは、個性タブはOR検索で「毒アタック」「毒キラー」を選択し、特技タブでは「毒付与」を選択し、間のボタンはANDにする
                            </li>
                        </ul>
                    </div>

                    <!-- ページ8: カテゴリ名の解説 -->
                    <div class="help-page" data-page="8" style="display: none;">
                        <h2>カテゴリ名の解説</h2>

                        <h3>個性タブのカテゴリ</h3>

                        <h4>バフ</h4>
                        <ul>
                            <li><strong>アップ系</strong>：能力値を上げる効果（つよさアップ、攻撃力アップなど）</li>
                            <li><strong>軽減系</strong>：ダメージや確率を軽減する効果</li>
                            <li><strong>抵抗系</strong>：デバフを防ぐ効果（気絶抵抗、呪縛抵抗など）</li>
                            <li><strong>その他バフ</strong>：上記以外のバフ効果</li>
                        </ul>

                        <h4>デバフ</h4>
                        <ul>
                            <li><strong>ダウン系</strong>：能力値を下げる効果（つよさダウン、いどうダウンなど）</li>
                            <li><strong>その他デバフ</strong>：上記以外のデバフ効果</li>
                        </ul>

                        <h4>状態異常</h4>
                        <ul>
                            <li><strong>毒系</strong>：毒に関する効果（毒付与、毒キラーなど）</li>
                            <li><strong>気絶系</strong>：気絶に関する効果（気絶付与、気絶アタックなど）</li>
                            <li><strong>その他状態異常</strong>：呪縛、足止め、小人化などのその他の状態異常</li>
                        </ul>

                        <h3>特技タブのカテゴリ</h3>
                        <ul>
                            <li><strong>ダメージのみ</strong>：基本ダメージ効果のみで、追加効果がない特技</li>
                            <li><strong>回復系</strong>：HP回復、毒解除、気絶解除などの回復・解除効果</li>
                            <li><strong>バフ系</strong>：能力値アップ、被ダメージ軽減などのバフ効果</li>
                            <li><strong>デバフ(状態異常)系</strong>：能力値ダウン、毒付与、気絶付与などのデバフ・状態異常効果</li>
                        </ul>
                    </div>

                    <!-- ページ9: 不具合報告 -->
                    <div class="help-page" data-page="9" style="display: none;">
                        <h2>不具合報告</h2>
                        <p class="modal-overview">
                            不具合やミスの報告を匿名で制作者に送信できます。内容はDiscordに転送されるため返信はありません。気軽に報告してください。
                        </p>

                        <div id="bug-report-form" style="margin-top: 2vh;">
                            <div style="margin-bottom: 1.5vh;">
                                <label for="bug-report-text"
                                    style="display: block; margin-bottom: 0.5vh; font-weight: bold;">不具合の内容</label>
                                <textarea id="bug-report-text"
                                    style="width: 100%; min-height: 10vh; padding: 0.8vh; font-size: 1.4vh; border: 1px solid #555; background-color: #2a3a4a; color: #fff; border-radius: 0.4vh; resize: vertical;"
                                    placeholder="具体的に不具合やミスを入力してください(例：〇〇の要求が間違っている、△△のバフで絞り込んでも〇〇が出てこない(もしくは〇〇が間違って出てくる)、機能が動作しないなど)"></textarea>
                            </div>
                            <button id="bug-report-submit" class="control-button"
                                style="width: 100%; margin-top: 1vh;">報告を送信</button>
                            <div id="bug-report-status"
                                style="margin-top: 1vh; font-size: 1.2vh; color: #aaa; display: none;"></div>
                        </div>
                    </div>
                </div>

                <!-- ページネーションコントロール -->
                <div class="help-pagination">
                    <button id="help-prev-button" class="control-button" disabled>前へ</button>
                    <div class="help-page-dots" id="help-page-dots">
                        <!-- JavaScriptで動的に生成 -->
                    </div>
                    <button id="help-next-button" class="control-button">次へ</button>
                </div>
                <button id="close-modal-button" class="control-button">閉じる</button>
            </div>
        </div>
    </div>

    <script>
        // Jinja2変数定義（main.jsより先に読み込み）
        const ALL_ALIENS = {{ all_aliens | tojson | safe }};
        const ALIEN_SKILL_DATA = {{ alien_skill_data | tojson | safe }};
        const ALL_EFFECTS = {{ all_effects | tojson | safe }};
        const S_SKILL_EFFECTS = {{ s_skill_effects | tojson | safe }};
        const ALIEN_EFFECTS = {{ alien_effects | tojson | safe }};
    </script>

</body>

</html>